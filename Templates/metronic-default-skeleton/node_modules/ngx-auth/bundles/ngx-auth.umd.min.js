!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/router"),require("rxjs/operators"),require("@angular/common/http"),require("rxjs")):"function"==typeof define&&define.amd?define("ngx-auth",["exports","@angular/core","@angular/router","rxjs/operators","@angular/common/http","rxjs"],t):t(e["ngx-auth"]={},e.ng.core,e.ng.router,e.Rx.Observable.prototype,e.ng.common.http,e.rxjs)}(this,function(e,t,r,o,i,s){"use strict";var n=function(){},u=new t.InjectionToken("AUTH_SERVICE"),c=new t.InjectionToken("PUBLIC_FALLBACK_PAGE_URI"),a=new t.InjectionToken("PROTECTED_FALLBACK_PAGE_URI"),p=function(){function e(e,t,r){this.authService=e,this.protectedFallbackPageUri=t,this.router=r}return e.prototype.canActivate=function(e,t){var r=this;return this.authService.isAuthorized().pipe(o.map(function(e){return!(e&&!r.isProtectedPage(t))||(r.navigate(r.protectedFallbackPageUri),!1)}))},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.isProtectedPage=function(e){return e.url===this.protectedFallbackPageUri},e.prototype.navigate=function(e){e.startsWith("http")?window.location.href=e:this.router.navigateByUrl(e)},e}();p.decorators=[{type:t.Injectable}],p.ctorParameters=function(){return[{type:n,decorators:[{type:t.Inject,args:[u]}]},{type:undefined,decorators:[{type:t.Inject,args:[a]}]},{type:r.Router}]};var h=function(){function e(e,t,r){this.authService=e,this.publicFallbackPageUri=t,this.router=r}return e.prototype.canActivate=function(e,t){var r=this;return this.authService.isAuthorized().pipe(o.map(function(e){return!(!e&&!r.isPublicPage(t))||(r.authService.setInterruptedUrl&&r.authService.setInterruptedUrl(t.url),r.navigate(r.publicFallbackPageUri),!1)}))},e.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},e.prototype.isPublicPage=function(e){return e.url===this.publicFallbackPageUri},e.prototype.navigate=function(e){e.startsWith("http")?window.location.href=e:this.router.navigateByUrl(e)},e}();h.decorators=[{type:t.Injectable}],h.ctorParameters=function(){return[{type:n,decorators:[{type:t.Inject,args:[u]}]},{type:undefined,decorators:[{type:t.Inject,args:[c]}]},{type:r.Router}]};var f=function(){function e(e){this.injector=e,this.refreshInProgress=!1,this.refreshSubject=new s.Subject}return e.prototype.intercept=function(e,t){return this.injector.get(u).verifyTokenRequest(e.url)?t.handle(e):this.processIntercept(e,t)},e.prototype.processIntercept=function(e,t){var r=this,n=e.clone();return this.request(n).pipe(o.switchMap(function(e){return t.handle(e)}),o.catchError(function(e){return r.responseError(n,e)}))},e.prototype.request=function(e){return this.refreshInProgress?this.delayRequest(e):this.addToken(e)},e.prototype.responseError=function(e,t){var r=this,n=this.injector.get(u),o=n.refreshShouldHappen(t);return o&&!this.refreshInProgress&&(this.refreshInProgress=!0,n.refreshToken().subscribe(function(){r.refreshInProgress=!1,r.refreshSubject.next(!0)},function(){r.refreshInProgress=!1,r.refreshSubject.next(!1)})),o&&this.refreshInProgress?this.retryRequest(e,t):s.throwError(t)},e.prototype.addToken=function(r){var n=this.injector.get(u);return n.getAccessToken().pipe(o.map(function(e){if(e){var t=void 0;return t="function"==typeof n.getHeaders?n.getHeaders(e):{Authorization:"Bearer "+e},r.clone({setHeaders:t})}return r}),o.first())},e.prototype.delayRequest=function(t){var r=this;return this.refreshSubject.pipe(o.first(),o.switchMap(function(e){return e?r.addToken(t):s.throwError(t)}))},e.prototype.retryRequest=function(t,r){var n=this.injector.get(i.HttpClient);return this.refreshSubject.pipe(o.first(),o.switchMap(function(e){return e?n.request(t):s.throwError(r||t)}))},e}();f.decorators=[{type:t.Injectable}],f.ctorParameters=function(){return[{type:t.Injector}]};var d=function(){};d.decorators=[{type:t.NgModule,args:[{providers:[p,h,f,{provide:i.HTTP_INTERCEPTORS,useClass:f,multi:!0}]}]}],e.AuthService=n,e.PublicGuard=p,e.ProtectedGuard=h,e.AUTH_SERVICE=u,e.PUBLIC_FALLBACK_PAGE_URI=c,e.PROTECTED_FALLBACK_PAGE_URI=a,e.AuthModule=d,e.Éµa=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-auth.umd.min.js.map
